<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crypto Clicker Pro - Sistema de Cuentas</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Todos los estilos anteriores se mantienen */
        
        /* Nuevos estilos para login y cuenta */
        .login-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #0f172a, #1e1b4b);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            padding: 20px;
        }
        
        .login-container {
            background: rgba(30, 41, 59, 0.95);
            border-radius: 20px;
            padding: 30px;
            width: 100%;
            max-width: 500px;
            border: 3px solid var(--primary);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
        }
        
        .login-title {
            text-align: center;
            color: var(--premium);
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        .login-subtitle {
            text-align: center;
            color: #94a3b8;
            margin-bottom: 30px;
            font-size: 1rem;
        }
        
        .login-tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid rgba(59, 130, 246, 0.3);
        }
        
        .login-tab {
            flex: 1;
            padding: 15px;
            background: none;
            border: none;
            color: #94a3b8;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .login-tab.active {
            color: var(--primary);
            border-bottom: 3px solid var(--primary);
            font-weight: bold;
        }
        
        .login-form {
            display: none;
        }
        
        .login-form.active {
            display: block;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            color: #cbd5e1;
            font-size: 0.9rem;
        }
        
        .form-input {
            width: 100%;
            padding: 14px;
            border-radius: 10px;
            border: 2px solid rgba(59, 130, 246, 0.3);
            background: rgba(15, 23, 42, 0.8);
            color: white;
            font-size: 1rem;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
        }
        
        .password-toggle {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: #94a3b8;
            cursor: pointer;
        }
        
        .password-container {
            position: relative;
        }
        
        .login-btn {
            width: 100%;
            padding: 15px;
            border-radius: 10px;
            border: none;
            background: linear-gradient(135deg, var(--primary), #2563eb);
            color: white;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
        }
        
        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(59, 130, 246, 0.3);
        }
        
        .login-footer {
            text-align: center;
            margin-top: 20px;
            color: #94a3b8;
            font-size: 0.9rem;
        }
        
        .login-link {
            color: var(--primary);
            cursor: pointer;
            text-decoration: underline;
        }
        
        /* Secci√≥n de cuenta */
        .account-section {
            background: rgba(30, 41, 59, 0.7);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            border: 2px solid var(--primary);
        }
        
        .account-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .account-field {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 10px;
        }
        
        .field-label {
            font-size: 0.8rem;
            color: #94a3b8;
            margin-bottom: 5px;
        }
        
        .field-value {
            font-size: 1.1rem;
            font-weight: bold;
            color: white;
            word-break: break-all;
        }
        
        .copy-field {
            position: relative;
        }
        
        .copy-field-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(59, 130, 246, 0.2);
            border: 1px solid var(--primary);
            color: white;
            padding: 5px 10px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s;
        }
        
        .copy-field-btn:hover {
            background: var(--primary);
        }
        
        /* Backup section */
        .backup-section {
            background: rgba(30, 41, 59, 0.7);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            border: 2px solid var(--secondary);
        }
        
        .backup-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 15px;
        }
        
        @media (max-width: 768px) {
            .backup-options {
                grid-template-columns: 1fr;
            }
        }
        
        .backup-card {
            background: rgba(16, 185, 129, 0.1);
            border-radius: 12px;
            padding: 20px;
            border: 2px solid var(--secondary);
            text-align: center;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .backup-card:hover {
            transform: translateY(-5px);
            border-color: var(--secondary);
        }
        
        .backup-icon {
            font-size: 2.5rem;
            color: var(--secondary);
            margin-bottom: 15px;
        }
        
        .backup-title {
            font-size: 1.2rem;
            font-weight: bold;
            color: white;
            margin-bottom: 10px;
        }
        
        .backup-description {
            font-size: 0.9rem;
            color: #cbd5e1;
            margin-bottom: 15px;
        }
        
        /* Recovery section */
        .recovery-section {
            background: rgba(30, 41, 59, 0.7);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            border: 2px solid var(--warning);
        }
        
        .recovery-input {
            margin: 15px 0;
        }
        
        .recovery-textarea {
            width: 100%;
            padding: 15px;
            border-radius: 10px;
            border: 2px solid var(--warning);
            background: rgba(15, 23, 42, 0.8);
            color: white;
            font-family: monospace;
            font-size: 0.9rem;
            min-height: 150px;
            resize: vertical;
        }
        
        /* User menu en header */
        .user-menu {
            position: fixed;
            top: 80px;
            right: 15px;
            background: rgba(30, 41, 59, 0.95);
            border-radius: 10px;
            padding: 10px;
            border: 2px solid var(--primary);
            display: none;
            z-index: 1001;
            min-width: 200px;
        }
        
        .user-menu.active {
            display: block;
            animation: fadeIn 0.3s;
        }
        
        .user-menu-item {
            padding: 12px 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            color: #cbd5e1;
            cursor: pointer;
            transition: all 0.3s;
            border-radius: 8px;
        }
        
        .user-menu-item:hover {
            background: rgba(59, 130, 246, 0.1);
            color: white;
        }
        
        .user-menu-divider {
            height: 1px;
            background: rgba(255, 255, 255, 0.1);
            margin: 5px 0;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), #2563eb);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            cursor: pointer;
        }
        
        .user-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--secondary);
            color: white;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* Referral system */
        .referral-section {
            background: rgba(30, 41, 59, 0.7);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            border: 2px solid var(--mission);
        }
        
        .referral-code-container {
            background: rgba(139, 92, 246, 0.1);
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            text-align: center;
        }
        
        .referral-code {
            font-family: monospace;
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--mission);
            letter-spacing: 2px;
            margin: 10px 0;
        }
        
        .referral-stats {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
            margin: 20px 0;
        }
        
        @media (max-width: 768px) {
            .referral-stats {
                grid-template-columns: 1fr;
            }
        }
        
        .referral-stat {
            background: rgba(0, 0, 0, 0.2);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }
        
        .stat-number {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--premium);
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #94a3b8;
        }
        
        /* Cloud sync status */
        .sync-status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-left: 10px;
        }
        
        .sync-synced {
            background: rgba(16, 185, 129, 0.2);
            color: var(--secondary);
            border: 1px solid var(--secondary);
        }
        
        .sync-pending {
            background: rgba(245, 158, 11, 0.2);
            color: var(--warning);
            border: 1px solid var(--warning);
        }
        
        .sync-error {
            background: rgba(239, 68, 68, 0.2);
            color: var(--danger);
            border: 1px solid var(--danger);
        }
        
        /* Auto-backup notice */
        .auto-backup-notice {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid var(--primary);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .backup-timer {
            font-family: monospace;
            font-weight: bold;
            color: var(--warning);
        }
        
        /* Loading spinner */
        .spinner {
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            border-top: 3px solid var(--primary);
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- Overlay de Login (se muestra al inicio) -->
    <div id="loginOverlay" class="login-overlay">
        <div class="login-container">
            <h1 class="login-title">Crypto Clicker Pro</h1>
            <p class="login-subtitle">Inicia sesi√≥n o crea una cuenta para comenzar</p>
            
            <div class="login-tabs">
                <button class="login-tab active" data-form="loginForm">Iniciar Sesi√≥n</button>
                <button class="login-tab" data-form="registerForm">Crear Cuenta</button>
                <button class="login-tab" data-form="guestForm">Jugar como Invitado</button>
            </div>
            
            <!-- Formulario de Login -->
            <form id="loginForm" class="login-form active">
                <div class="form-group">
                    <label class="form-label">Correo Electr√≥nico o ID de Usuario</label>
                    <input type="text" id="loginEmail" class="form-input" placeholder="tucorreo@ejemplo.com">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Contrase√±a</label>
                    <div class="password-container">
                        <input type="password" id="loginPassword" class="form-input" placeholder="Tu contrase√±a">
                        <button type="button" class="password-toggle" onclick="togglePassword('loginPassword')">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>
                
                <button type="button" class="login-btn" onclick="loginUser()">
                    <i class="fas fa-sign-in-alt"></i> Iniciar Sesi√≥n
                </button>
                
                <div class="login-footer">
                    <a class="login-link" onclick="showForm('recoveryForm')">¬øOlvidaste tu contrase√±a?</a>
                </div>
            </form>
            
            <!-- Formulario de Registro -->
            <form id="registerForm" class="login-form">
                <div class="form-group">
                    <label class="form-label">Correo Electr√≥nico</label>
                    <input type="email" id="registerEmail" class="form-input" placeholder="tucorreo@ejemplo.com">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Nombre de Usuario</label>
                    <input type="text" id="registerUsername" class="form-input" placeholder="Tu nombre de usuario">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Contrase√±a</label>
                    <div class="password-container">
                        <input type="password" id="registerPassword" class="form-input" placeholder="M√≠nimo 8 caracteres">
                        <button type="button" class="password-toggle" onclick="togglePassword('registerPassword')">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Confirmar Contrase√±a</label>
                    <div class="password-container">
                        <input type="password" id="registerConfirmPassword" class="form-input" placeholder="Repite tu contrase√±a">
                        <button type="button" class="password-toggle" onclick="togglePassword('registerConfirmPassword')">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">C√≥digo de Referido (Opcional)</label>
                    <input type="text" id="registerReferral" class="form-input" placeholder="C√≥digo de amigo">
                </div>
                
                <button type="button" class="login-btn" onclick="registerUser()">
                    <i class="fas fa-user-plus"></i> Crear Cuenta
                </button>
            </form>
            
            <!-- Modo Invitado -->
            <form id="guestForm" class="login-form">
                <div class="form-group">
                    <p style="color: #cbd5e1; text-align: center; margin-bottom: 20px;">
                        Juega sin crear cuenta. Tus datos se guardar√°n localmente en este dispositivo.
                        <br><br>
                        <strong>‚ö†Ô∏è Advertencia:</strong> Si borras el cach√© del navegador, perder√°s tu progreso.
                    </p>
                </div>
                
                <button type="button" class="login-btn" onclick="enterAsGuest()">
                    <i class="fas fa-play"></i> Jugar como Invitado
                </button>
                
                <div class="login-footer">
                    Puedes crear una cuenta m√°s tarde para guardar tu progreso en la nube.
                </div>
            </form>
            
            <!-- Recuperaci√≥n de Contrase√±a -->
            <form id="recoveryForm" class="login-form">
                <div class="form-group">
                    <p style="color: #cbd5e1; text-align: center; margin-bottom: 20px;">
                        Introduce tu correo electr√≥nico o ID de usuario para recuperar tu cuenta.
                    </p>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Correo o ID de Usuario</label>
                    <input type="text" id="recoveryEmail" class="form-input" placeholder="tucorreo@ejemplo.com">
                </div>
                
                <button type="button" class="login-btn" onclick="recoverAccount()">
                    <i class="fas fa-key"></i> Recuperar Cuenta
                </button>
                
                <div class="login-footer">
                    <a class="login-link" onclick="showForm('loginForm')">Volver al Login</a>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Header con Avatar de Usuario -->
    <div class="compact-header">
        <div class="compact-stat">
            <div class="compact-label">üí∞ Dinero</div>
            <div class="compact-value" id="compactMoney">0</div>
            <div class="compact-subvalue" id="compactMoneyPerSec">+0/s</div>
        </div>
        
        <div class="compact-stat">
            <div class="compact-label">‚Çø Cripto</div>
            <div class="compact-value crypto" id="compactCrypto">0.000000</div>
            <div class="compact-subvalue">‚âà $<span id="compactCryptoUSD">0.00</span></div>
        </div>
        
        <div class="compact-stat">
            <div class="compact-label">üë§ Usuario</div>
            <div class="compact-value" id="compactUsername">Invitado</div>
            <div class="compact-subvalue">
                <span id="compactSyncStatus" class="sync-status sync-synced">Online</span>
            </div>
        </div>
        
        <!-- Avatar de usuario -->
        <div style="position: absolute; top: 10px; right: 15px;">
            <div class="user-avatar" onclick="toggleUserMenu()" id="userAvatar">
                <span id="avatarInitial">I</span>
                <div class="user-badge" id="userBadge" style="display: none;">3</div>
            </div>
            <div class="user-menu" id="userMenu">
                <div class="user-menu-item" onclick="showAccountSection()">
                    <i class="fas fa-user-circle"></i>
                    <span>Mi Cuenta</span>
                </div>
                <div class="user-menu-item" onclick="backupData()">
                    <i class="fas fa-download"></i>
                    <span>Descargar Backup</span>
                </div>
                <div class="user-menu-item" onclick="showBackupSection()">
                    <i class="fas fa-upload"></i>
                    <span>Restaurar Backup</span>
                </div>
                <div class="user-menu-divider"></div>
                <div class="user-menu-item" onclick="showReferralSection()">
                    <i class="fas fa-users"></i>
                    <span>Invitar Amigos</span>
                    <div class="user-badge" style="position: static; margin-left: auto;">5</div>
                </div>
                <div class="user-menu-divider"></div>
                <div class="user-menu-item" onclick="logoutUser()" style="color: var(--danger);">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Cerrar Sesi√≥n</span>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Contenido principal -->
    <div class="main-content">
        <!-- Clicker y otras secciones se mantienen igual -->
        
        <!-- NUEVA SECCI√ìN: Cuenta del Usuario -->
        <div class="tab-content" id="tab-account">
            <!-- Info de cuenta -->
            <div class="account-section">
                <h3 class="section-title">
                    <i class="fas fa-user-circle"></i> Informaci√≥n de Cuenta
                </h3>
                
                <div class="account-info">
                    <div class="account-field copy-field">
                        <div class="field-label">ID de Usuario</div>
                        <div class="field-value" id="accountUserId">USR-000000</div>
                        <button class="copy-field-btn" onclick="copyToClipboard('accountUserId')">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                    
                    <div class="account-field">
                        <div class="field-label">Nombre de Usuario</div>
                        <div class="field-value" id="accountUsername">Invitado</div>
                    </div>
                    
                    <div class="account-field">
                        <div class="field-label">Correo Electr√≥nico</div>
                        <div class="field-value" id="accountEmail">No registrado</div>
                    </div>
                    
                    <div class="account-field">
                        <div class="field-label">Tipo de Cuenta</div>
                        <div class="field-value" id="accountType">Invitado</div>
                    </div>
                    
                    <div class="account-field">
                        <div class="field-label">Miembro desde</div>
                        <div class="field-value" id="accountCreated">Hoy</div>
                    </div>
                    
                    <div class="account-field">
                        <div class="field-label">√öltimo Backup</div>
                        <div class="field-value" id="accountLastBackup">Nunca</div>
                    </div>
                </div>
                
                <div class="auto-backup-notice">
                    <div>
                        <i class="fas fa-sync-alt"></i>
                        <span>Auto-backup cada: <span class="backup-timer" id="backupTimer">05:00</span></span>
                    </div>
                    <button class="btn btn-warning" onclick="forceBackup()">
                        <i class="fas fa-save"></i> Guardar Ahora
                    </button>
                </div>
            </div>
            
            <!-- Sistema de Backup -->
            <div class="backup-section">
                <h3 class="section-title">
                    <i class="fas fa-database"></i> Sistema de Backup
                </h3>
                <p style="margin-bottom: 15px; color: #cbd5e1; font-size: 0.9rem;">
                    Guarda tu progreso de forma segura. Recomendamos hacer backup cada vez que ganes gemas o hagas una compra.
                </p>
                
                <div class="backup-options">
                    <div class="backup-card" onclick="backupData()">
                        <div class="backup-icon">
                            <i class="fas fa-download"></i>
                        </div>
                        <div class="backup-title">Descargar Backup</div>
                        <div class="backup-description">
                            Guarda un archivo .json con todos tus datos. Gu√°rdalo en un lugar seguro.
                        </div>
                        <button class="btn btn-success">
                            <i class="fas fa-file-download"></i> Descargar
                        </button>
                    </div>
                    
                    <div class="backup-card" onclick="showBackupInput()">
                        <div class="backup-icon">
                            <i class="fas fa-upload"></i>
                        </div>
                        <div class="backup-title">Restaurar Backup</div>
                        <div class="backup-description">
                            Sube un archivo .json para restaurar tu progreso desde un backup anterior.
                        </div>
                        <button class="btn btn-warning">
                            <i class="fas fa-file-upload"></i> Restaurar
                        </button>
                    </div>
                </div>
                
                <!-- Input para restaurar backup (oculto por defecto) -->
                <div id="restoreBackupContainer" style="display: none; margin-top: 20px;">
                    <div class="form-group">
                        <label class="form-label">Pega aqu√≠ tu c√≥digo de backup:</label>
                        <textarea id="backupDataInput" class="recovery-textarea" placeholder='{"userId": "USR-123456", "data": {...}}'></textarea>
                    </div>
                    
                    <div style="display: flex; gap: 10px; margin-top: 10px;">
                        <button class="btn btn-success" onclick="restoreBackupFromInput()">
                            <i class="fas fa-check"></i> Restaurar
                        </button>
                        <button class="btn btn-danger" onclick="hideBackupInput()">
                            <i class="fas fa-times"></i> Cancelar
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Sistema de Referidos -->
            <div class="referral-section">
                <h3 class="section-title">
                    <i class="fas fa-users"></i> Sistema de Referidos
                </h3>
                <p style="margin-bottom: 15px; color: #cbd5e1; font-size: 0.9rem;">
                    Invita amigos y gana recompensas. Por cada amigo que se registre con tu c√≥digo, ambos recibir√°n gemas.
                </p>
                
                <div class="referral-code-container">
                    <div class="field-label">Tu C√≥digo de Referido</div>
                    <div class="referral-code" id="referralCode">REF-000000</div>
                    <button class="btn btn-premium" onclick="copyToClipboard('referralCode')">
                        <i class="fas fa-copy"></i> Copiar C√≥digo
                    </button>
                </div>
                
                <div class="referral-stats">
                    <div class="referral-stat">
                        <div class="stat-number" id="referralsCount">0</div>
                        <div class="stat-label">Referidos</div>
                    </div>
                    <div class="referral-stat">
                        <div class="stat-number" id="referralEarnings">0</div>
                        <div class="stat-label">Gemas Ganadas</div>
                    </div>
                    <div class="referral-stat">
                        <div class="stat-number" id="referralBonus">+10%</div>
                        <div class="stat-label">Bonus por Referido</div>
                    </div>
                </div>
                
                <div style="background: rgba(251, 191, 36, 0.1); border-radius: 10px; padding: 15px; margin-top: 15px;">
                    <h4 style="color: var(--premium); margin-bottom: 10px;">
                        <i class="fas fa-gift"></i> Recompensas por Referidos
                    </h4>
                    <ul style="color: #cbd5e1; font-size: 0.9rem; padding-left: 20px;">
                        <li><strong>Por cada referido:</strong> +10 gemas para ti y para tu amigo</li>
                        <li><strong>Por 5 referidos:</strong> +10% bonus en todas tus ganancias</li>
                        <li><strong>Por 10 referidos:</strong> +25% bonus y acceso a mejoras exclusivas</li>
                        <li><strong>Por 50 referidos:</strong> Cuenta VIP con +50% bonus y retiros sin comisi√≥n</li>
                    </ul>
                </div>
            </div>
            
            <!-- Historial de Actividad -->
            <div class="section section-crypto">
                <h3 class="section-title">
                    <i class="fas fa-history"></i> Historial de Actividad
                </h3>
                
                <div style="overflow-x: auto;">
                    <table class="transactions-table">
                        <thead>
                            <tr>
                                <th>Fecha</th>
                                <th>Actividad</th>
                                <th>Detalles</th>
                                <th>IP/Location</th>
                            </tr>
                        </thead>
                        <tbody id="activityHistory">
                            <tr>
                                <td colspan="4" style="text-align: center; color: #94a3b8; padding: 20px;">
                                    Cargando historial...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <button class="btn btn-warning" onclick="clearActivityHistory()" style="margin-top: 15px;">
                    <i class="fas fa-trash"></i> Limpiar Historial
                </button>
            </div>
        </div>
    </div>
    
    <!-- Tabs de navegaci√≥n (actualizadas) -->
    <div class="tabs-container">
        <button class="tab-button" data-tab="tab-generators">
            <i class="fas fa-industry"></i>
            <span>Generadores</span>
        </button>
        <button class="tab-button" data-tab="tab-upgrades">
            <i class="fas fa-gem"></i>
            <span>Mejoras</span>
        </button>
        <button class="tab-button" data-tab="tab-gems">
            <i class="fas fa-shopping-cart"></i>
            <span>Tienda</span>
        </button>
        <button class="tab-button" data-tab="tab-missions">
            <i class="fas fa-tasks"></i>
            <span>Misiones</span>
        </button>
        <button class="tab-button" data-tab="tab-crypto">
            <i class="fab fa-bitcoin"></i>
            <span>Cripto</span>
        </button>
        <button class="tab-button" data-tab="tab-payments">
            <i class="fas fa-money-bill-wave"></i>
            <span>Pagos</span>
        </button>
        <button class="tab-button" data-tab="tab-account">
            <i class="fas fa-user-circle"></i>
            <span>Cuenta</span>
        </button>
    </div>
    
    <!-- Notificaciones -->
    <div id="notification" class="notification"></div>

    <script>
        // ================= SISTEMA DE USUARIOS =================
        
        // Variables de usuario
        let currentUser = null;
        let isGuest = false;
        let autoBackupInterval = null;
        let backupTimer = 300; // 5 minutos en segundos
        
        // Almacenamiento de usuarios (simulado - en producci√≥n ser√≠a una base de datos)
        const USERS_DB_KEY = 'cryptoClicker_users';
        const CURRENT_USER_KEY = 'cryptoClicker_currentUser';
        const USER_DATA_PREFIX = 'cryptoClicker_user_';
        
        // Inicializar sistema de usuarios
        function initUserSystem() {
            // Intentar cargar usuario actual
            const savedUser = localStorage.getItem(CURRENT_USER_KEY);
            
            if (savedUser) {
                try {
                    currentUser = JSON.parse(savedUser);
                    isGuest = currentUser.type === 'guest';
                    loadUserData();
                    hideLoginScreen();
                    startAutoBackup();
                } catch (e) {
                    console.error('Error al cargar usuario:', e);
                    showLoginScreen();
                }
            } else {
                showLoginScreen();
            }
        }
        
        // Mostrar pantalla de login
        function showLoginScreen() {
            document.getElementById('loginOverlay').style.display = 'flex';
            document.querySelector('.main-content').style.display = 'none';
            document.querySelector('.tabs-container').style.display = 'none';
            document.querySelector('.compact-header').style.display = 'none';
        }
        
        // Ocultar pantalla de login
        function hideLoginScreen() {
            document.getElementById('loginOverlay').style.display = 'none';
            document.querySelector('.main-content').style.display = 'block';
            document.querySelector('.tabs-container').style.display = 'flex';
            document.querySelector('.compact-header').style.display = 'grid';
            
            // Actualizar avatar
            updateUserAvatar();
            updateAccountUI();
        }
        
        // Cambiar entre formularios
        function showForm(formId) {
            // Ocultar todos los formularios
            document.querySelectorAll('.login-form').forEach(form => {
                form.classList.remove('active');
            });
            
            // Desactivar todas las pesta√±as
            document.querySelectorAll('.login-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Mostrar formulario seleccionado
            document.getElementById(formId).classList.add('active');
            
            // Activar pesta√±a correspondiente
            document.querySelector(`.login-tab[data-form="${formId}"]`).classList.add('active');
        }
        
        // Registrar nuevo usuario
        function registerUser() {
            const email = document.getElementById('registerEmail').value.trim();
            const username = document.getElementById('registerUsername').value.trim();
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('registerConfirmPassword').value;
            const referralCode = document.getElementById('registerReferral').value.trim();
            
            // Validaciones
            if (!email || !username || !password) {
                showNotification('Por favor completa todos los campos', 'error');
                return;
            }
            
            if (password.length < 6) {
                showNotification('La contrase√±a debe tener al menos 6 caracteres', 'error');
                return;
            }
            
            if (password !== confirmPassword) {
                showNotification('Las contrase√±as no coinciden', 'error');
                return;
            }
            
            if (!validateEmail(email)) {
                showNotification('Correo electr√≥nico inv√°lido', 'error');
                return;
            }
            
            // Cargar base de datos de usuarios
            let usersDB = JSON.parse(localStorage.getItem(USERS_DB_KEY)) || {};
            
            // Verificar si el usuario ya existe
            if (usersDB[email]) {
                showNotification('Este correo ya est√° registrado', 'error');
                return;
            }
            
            // Verificar si el username ya existe
            const existingUser = Object.values(usersDB).find(user => user.username === username);
            if (existingUser) {
                showNotification('Este nombre de usuario ya est√° en uso', 'error');
                return;
            }
            
            // Generar ID √∫nico
            const userId = generateUserId();
            
            // Crear usuario
            const user = {
                id: userId,
                email: email,
                username: username,
                password: hashPassword(password), // En producci√≥n usar bcrypt
                type: 'registered',
                created: new Date().toISOString(),
                lastLogin: new Date().toISOString(),
                referralCode: generateReferralCode(),
                referredBy: referralCode || null,
                referrals: [],
                totalEarned: 0,
                totalWithdrawn: 0,
                trustScore: 100,
                isVerified: false
            };
            
            // Guardar usuario en base de datos
            usersDB[email] = user;
            localStorage.setItem(USERS_DB_KEY, JSON.stringify(usersDB));
            
            // Crear datos iniciales para el usuario
            createUserData(userId);
            
            // Iniciar sesi√≥n autom√°ticamente
            loginUserWithCredentials(email, password);
            
            // Aplicar bonus por referido si existe
            if (referralCode) {
                applyReferralBonus(referralCode, userId);
            }
            
            showNotification('¬°Cuenta creada exitosamente!', 'success');
        }
        
        // Iniciar sesi√≥n
        function loginUser() {
            const emailOrUsername = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;
            
            loginUserWithCredentials(emailOrUsername, password);
        }
        
        // Iniciar sesi√≥n con credenciales
        function loginUserWithCredentials(emailOrUsername, password) {
            // Cargar base de datos de usuarios
            const usersDB = JSON.parse(localStorage.getItem(USERS_DB_KEY)) || {};
            
            // Buscar usuario por email o username
            let user = null;
            let userKey = null;
            
            // Buscar por email
            if (usersDB[emailOrUsername]) {
                user = usersDB[emailOrUsername];
                userKey = emailOrUsername;
            } else {
                // Buscar por username
                for (const [key, u] of Object.entries(usersDB)) {
                    if (u.username === emailOrUsername) {
                        user = u;
                        userKey = key;
                        break;
                    }
                }
            }
            
            // Verificar usuario y contrase√±a
            if (!user || user.password !== hashPassword(password)) {
                showNotification('Credenciales incorrectas', 'error');
                return;
            }
            
            // Actualizar √∫ltimo login
            user.lastLogin = new Date().toISOString();
            usersDB[userKey] = user;
            localStorage.setItem(USERS_DB_KEY, JSON.stringify(usersDB));
            
            // Establecer usuario actual
            currentUser = user;
            isGuest = false;
            
            // Guardar sesi√≥n
            localStorage.setItem(CURRENT_USER_KEY, JSON.stringify(currentUser));
            
            // Cargar datos del usuario
            loadUserData();
            
            // Ocultar login
            hideLoginScreen();
            
            // Iniciar auto-backup
            startAutoBackup();
            
            showNotification(`¬°Bienvenido de nuevo, ${user.username}!`, 'success');
        }
        
        // Entrar como invitado
        function enterAsGuest() {
            const guestId = 'guest_' + Date.now();
            
            currentUser = {
                id: guestId,
                email: null,
                username: 'Invitado_' + Math.floor(Math.random() * 10000),
                type: 'guest',
                created: new Date().toISOString(),
                lastLogin: new Date().toISOString(),
                referralCode: null,
                referrals: [],
                totalEarned: 0,
                totalWithdrawn: 0
            };
            
            // Guardar sesi√≥n
            localStorage.setItem(CURRENT_USER_KEY, JSON.stringify(currentUser));
            
            // Crear datos iniciales
            createUserData(guestId);
            
            // Cargar datos
            loadUserData();
            
            // Ocultar login
            hideLoginScreen();
            
            // Iniciar auto-backup
            startAutoBackup();
            
            showNotification('Jugando como invitado. ¬°Crea una cuenta para guardar tu progreso!', 'warning');
        }
        
        // Recuperar cuenta
        function recoverAccount() {
            const emailOrUsername = document.getElementById('recoveryEmail').value.trim();
            
            if (!emailOrUsername) {
                showNotification('Ingresa tu correo o nombre de usuario', 'error');
                return;
            }
            
            // Cargar base de datos
            const usersDB = JSON.parse(localStorage.getItem(USERS_DB_KEY)) || {};
            
            // Buscar usuario
            let user = null;
            
            // Buscar por email
            if (usersDB[emailOrUsername]) {
                user = usersDB[emailOrUsername];
            } else {
                // Buscar por username
                for (const u of Object.values(usersDB)) {
                    if (u.username === emailOrUsername) {
                        user = u;
                        break;
                    }
                }
            }
            
            if (!user) {
                showNotification('Usuario no encontrado', 'error');
                return;
            }
            
            // Generar c√≥digo de recuperaci√≥n
            const recoveryCode = Math.random().toString(36).substring(2, 8).toUpperCase();
            
            // Guardar c√≥digo temporalmente (en producci√≥n enviar por email)
            localStorage.setItem('recovery_code_' + user.id, recoveryCode);
            
            // Mostrar c√≥digo (en producci√≥n enviar por email)
            showNotification(`C√≥digo de recuperaci√≥n: ${recoveryCode}. Gu√°rdalo en un lugar seguro.`, 'info');
            
            // Pedir c√≥digo
            const userCode = prompt('Ingresa el c√≥digo de recuperaci√≥n:');
            
            if (userCode === recoveryCode) {
                // Permitir cambiar contrase√±a
                const newPassword = prompt('Ingresa tu nueva contrase√±a (m√≠nimo 6 caracteres):');
                
                if (newPassword && newPassword.length >= 6) {
                    // Actualizar contrase√±a
                    user.password = hashPassword(newPassword);
                    usersDB[user.email] = user;
                    localStorage.setItem(USERS_DB_KEY, JSON.stringify(usersDB));
                    
                    showNotification('Contrase√±a actualizada exitosamente', 'success');
                    showForm('loginForm');
                } else {
                    showNotification('Contrase√±a inv√°lida', 'error');
                }
            } else {
                showNotification('C√≥digo incorrecto', 'error');
            }
        }
        
        // Cerrar sesi√≥n
        function logoutUser() {
            // Hacer backup final
            backupUserData();
            
            // Cerrar sesi√≥n
            localStorage.removeItem(CURRENT_USER_KEY);
            currentUser = null;
            isGuest = false;
            
            // Detener auto-backup
            if (autoBackupInterval) {
                clearInterval(autoBackupInterval);
            }
            
            // Mostrar login
            showLoginScreen();
            
            showNotification('Sesi√≥n cerrada exitosamente', 'info');
        }
        
        // ================= SISTEMA DE DATOS =================
        
        // Cargar datos del usuario
        function loadUserData() {
            if (!currentUser) return;
            
            const userDataKey = USER_DATA_PREFIX + currentUser.id;
            const savedData = localStorage.getItem(userDataKey);
            
            if (savedData) {
                try {
                    const gameData = JSON.parse(savedData);
                    
                    // Restaurar datos del juego
                    money = gameData.money || 0;
                    crypto = gameData.crypto || 0;
                    gems = gameData.gems || 0;
                    clickPower = gameData.clickPower || 1;
                    totalClicks = gameData.totalClicks || 0;
                    totalMoneyEarned = gameData.totalMoneyEarned || 0;
                    clickUpgradeCost = gameData.clickUpgradeCost || 100;
                    clickUpgradeLevel = gameData.clickUpgradeLevel || 1;
                    clickMultiplier = gameData.clickMultiplier || 1;
                    userEarningsUSD = gameData.userEarningsUSD || 0;
                    availableFund = gameData.availableFund || 1000;
                    
                    // Restaurar generadores
                    if (gameData.generators) {
                        generators.forEach((gen, index) => {
                            if (gameData.generators[index]) {
                                gen.level = gameData.generators[index].level || 0;
                            }
                        });
                    }
                    
                    // Restaurar mejoras
                    if (gameData.moneyUpgrades) {
                        moneyUpgrades.forEach((upgrade, index) => {
                            if (gameData.moneyUpgrades[index]) {
                                upgrade.purchased = gameData.moneyUpgrades[index].purchased || false;
                            }
                        });
                    }
                    
                    // Restaurar historial
                    conversionHistory = gameData.conversionHistory || [];
                    withdrawalHistory = gameData.withdrawalHistory || [];
                    
                    // Restaurar misiones
                    if (gameData.missions) {
                        missions.forEach((mission, index) => {
                            if (gameData.missions[index]) {
                                mission.current = gameData.missions[index].current || 0;
                                mission.completed = gameData.missions[index].completed || false;
                            }
                        });
                    }
                    
                    showNotification('Datos cargados exitosamente', 'success');
                } catch (e) {
                    console.error('Error al cargar datos:', e);
                    createUserData(currentUser.id);
                }
            } else {
                createUserData(currentUser.id);
            }
            
            // Actualizar UI
            updateUI();
            updateAccountUI();
        }
        
        // Crear datos iniciales para usuario
        function createUserData(userId) {
            const initialData = {
                money: 0,
                crypto: 0,
                gems: 0,
                clickPower: 1,
                totalClicks: 0,
                totalMoneyEarned: 0,
                clickUpgradeCost: 100,
                clickUpgradeLevel: 1,
                clickMultiplier: 1,
                userEarningsUSD: 0,
                availableFund: 1000,
                generators: generators.map(g => ({ ...g })),
                moneyUpgrades: moneyUpgrades.map(u => ({ ...u })),
                gemPurchases: [],
                conversionHistory: [],
                withdrawalHistory: [],
                missions: missions.map(m => ({ ...m })),
                lastBackup: new Date().toISOString(),
                gameVersion: '1.0.0'
            };
            
            const userDataKey = USER_DATA_PREFIX + userId;
            localStorage.setItem(userDataKey, JSON.stringify(initialData));
        }
        
        // Guardar datos del usuario
        function saveUserData() {
            if (!currentUser) return;
            
            const userDataKey = USER_DATA_PREFIX + currentUser.id;
            
            const gameData = {
                money,
                crypto,
                gems,
                clickPower,
                totalClicks,
                totalMoneyEarned,
                clickUpgradeCost,
                clickUpgradeLevel,
                clickMultiplier,
                userEarningsUSD,
                availableFund,
                generators: generators.map(g => ({ 
                    id: g.id, 
                    level: g.level 
                })),
                moneyUpgrades: moneyUpgrades.map(u => ({
                    id: u.id,
                    purchased: u.purchased
                })),
                gemPurchases: [],
                conversionHistory,
                withdrawalHistory,
                missions: missions.map(m => ({
                    id: m.id,
                    current: m.current,
                    completed: m.completed
                })),
                lastBackup: new Date().toISOString(),
                gameVersion: '1.0.0'
            };
            
            localStorage.setItem(userDataKey, JSON.stringify(gameData));
            
            // Actualizar √∫ltimo backup en UI
            if (document.getElementById('accountLastBackup')) {
                document.getElementById('accountLastBackup').textContent = 
                    new Date().toLocaleTimeString();
            }
            
            return gameData;
        }
        
        // ================= BACKUP Y RESTAURACI√ìN =================
        
        // Hacer backup de datos
        function backupData() {
            if (!currentUser) {
                showNotification('Inicia sesi√≥n para hacer backup', 'error');
                return;
            }
            
            const gameData = saveUserData();
            
            // Crear objeto de backup completo
            const backup = {
                userId: currentUser.id,
                username: currentUser.username,
                email: currentUser.email,
                backupDate: new Date().toISOString(),
                gameData: gameData,
                checksum: generateChecksum(gameData)
            };
            
            // Convertir a JSON
            const backupJson = JSON.stringify(backup, null, 2);
            
            // Crear archivo para descargar
            const blob = new Blob([backupJson], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `crypto_clicker_backup_${currentUser.id}_${Date.now()}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('Backup descargado exitosamente', 'success');
        }
        
        // Restaurar desde backup
        function restoreBackupFromInput() {
            const backupJson = document.getElementById('backupDataInput').value.trim();
            
            if (!backupJson) {
                showNotification('Ingresa los datos del backup', 'error');
                return;
            }
            
            try {
                const backup = JSON.parse(backupJson);
                
                // Verificar checksum
                if (backup.checksum !== generateChecksum(backup.gameData)) {
                    showNotification('Backup corrupto o modificado', 'error');
                    return;
                }
                
                // Confirmar restauraci√≥n
                if (!confirm('¬øEst√°s seguro? Esto sobrescribir√° todos tus datos actuales.')) {
                    return;
                }
                
                // Restaurar datos
                const gameData = backup.gameData;
                
                money = gameData.money || 0;
                crypto = gameData.crypto || 0;
                gems = gameData.gems || 0;
                clickPower = gameData.clickPower || 1;
                totalClicks = gameData.totalClicks || 0;
                totalMoneyEarned = gameData.totalMoneyEarned || 0;
                clickUpgradeCost = gameData.clickUpgradeCost || 100;
                clickUpgradeLevel = gameData.clickUpgradeLevel || 1;
                clickMultiplier = gameData.clickMultiplier || 1;
                userEarningsUSD = gameData.userEarningsUSD || 0;
                availableFund = gameData.availableFund || 1000;
                
                // Restaurar generadores
                if (gameData.generators) {
                    generators.forEach((gen, index) => {
                        const savedGen = gameData.generators.find(g => g.id === gen.id);
                        if (savedGen) {
                            gen.level = savedGen.level || 0;
                        }
                    });
                }
                
                // Restaurar mejoras
                if (gameData.moneyUpgrades) {
                    moneyUpgrades.forEach((upgrade, index) => {
                        const savedUpgrade = gameData.moneyUpgrades.find(u => u.id === upgrade.id);
                        if (savedUpgrade) {
                            upgrade.purchased = savedUpgrade.purchased || false;
                        }
                    });
                }
                
                // Restaurar historial
                conversionHistory = gameData.conversionHistory || [];
                withdrawalHistory = gameData.withdrawalHistory || [];
                
                // Restaurar misiones
                if (gameData.missions) {
                    missions.forEach((mission, index) => {
                        const savedMission = gameData.missions.find(m => m.id === mission.id);
                        if (savedMission) {
                            mission.current = savedMission.current || 0;
                            mission.completed = savedMission.completed || false;
                        }
                    });
                }
                
                // Guardar datos
                saveUserData();
                
                // Actualizar UI
                updateUI();
                hideBackupInput();
                
                showNotification('Backup restaurado exitosamente', 'success');
            } catch (e) {
                console.error('Error al restaurar backup:', e);
                showNotification('Error en el formato del backup', 'error');
            }
        }
        
        // Mostrar input para restaurar backup
        function showBackupInput() {
            document.getElementById('restoreBackupContainer').style.display = 'block';
        }
        
        // Ocultar input de backup
        function hideBackupInput() {
            document.getElementById('restoreBackupContainer').style.display = 'none';
            document.getElementById('backupDataInput').value = '';
        }
        
        // Backup autom√°tico
        function startAutoBackup() {
            // Detener intervalo anterior si existe
            if (autoBackupInterval) {
                clearInterval(autoBackupInterval);
            }
            
            // Configurar timer
            updateBackupTimer();
            
            // Iniciar intervalo de backup (cada 5 minutos)
            autoBackupInterval = setInterval(() => {
                backupUserData();
            }, 5 * 60 * 1000); // 5 minutos
            
            // Iniciar contador visual
            setInterval(() => {
                backupTimer--;
                if (backupTimer <= 0) {
                    backupTimer = 300; // Reset a 5 minutos
                }
                updateBackupTimer();
            }, 1000);
        }
        
        // Actualizar timer de backup
        function updateBackupTimer() {
            const minutes = Math.floor(backupTimer / 60);
            const seconds = backupTimer % 60;
            const timerElement = document.getElementById('backupTimer');
            if (timerElement) {
                timerElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }
        }
        
        // Forzar backup ahora
        function forceBackup() {
            backupUserData();
            backupTimer = 300; // Reset timer
            updateBackupTimer();
            showNotification('Backup guardado exitosamente', 'success');
        }
        
        // Backup silencioso (sin notificaci√≥n)
        function backupUserData() {
            if (currentUser && !isGuest) {
                saveUserData();
            }
        }
        
        // ================= SISTEMA DE REFERIDOS =================
        
        // Aplicar bonus por referido
        function applyReferralBonus(referralCode, newUserId) {
            const usersDB = JSON.parse(localStorage.getItem(USERS_DB_KEY)) || {};
            
            // Buscar usuario por c√≥digo de referido
            let referrer = null;
            for (const user of Object.values(usersDB)) {
                if (user.referralCode === referralCode) {
                    referrer = user;
                    break;
                }
            }
            
            if (referrer) {
                // A√±adir referido a la lista
                referrer.referrals.push({
                    userId: newUserId,
                    date: new Date().toISOString(),
                    rewarded: false
                });
                
                // Guardar cambios
                usersDB[referrer.email] = referrer;
                localStorage.setItem(USERS_DB_KEY, JSON.stringify(usersDB));
                
                // Dar gemas al referido (esto se aplicar√° cuando cargue su juego)
                const referrerDataKey = USER_DATA_PREFIX + referrer.id;
                const referrerData = JSON.parse(localStorage.getItem(referrerDataKey)) || {};
                referrerData.gems = (referrerData.gems || 0) + 10;
                localStorage.setItem(referrerDataKey, JSON.stringify(referrerData));
                
                // Dar gemas al nuevo usuario
                const newUserDataKey = USER_DATA_PREFIX + newUserId;
                const newUserData = JSON.parse(localStorage.getItem(newUserDataKey)) || {};
                newUserData.gems = (newUserData.gems || 0) + 10;
                localStorage.setItem(newUserDataKey, JSON.stringify(newUserData));
                
                return true;
            }
            
            return false;
        }
        
        // ================= UI Y UTILIDADES =================
        
        // Actualizar UI de cuenta
        function updateAccountUI() {
            if (!currentUser) return;
            
            // Actualizar informaci√≥n de cuenta
            document.getElementById('accountUserId').textContent = currentUser.id;
            document.getElementById('accountUsername').textContent = currentUser.username;
            document.getElementById('accountEmail').textContent = currentUser.email || 'No registrado';
            document.getElementById('accountType').textContent = isGuest ? 'Invitado' : 'Registrado';
            document.getElementById('accountCreated').textContent = 
                new Date(currentUser.created).toLocaleDateString();
            
            // Actualizar avatar en header
            document.getElementById('compactUsername').textContent = currentUser.username;
            document.getElementById('avatarInitial').textContent = currentUser.username.charAt(0).toUpperCase();
            
            // Actualizar c√≥digo de referido
            document.getElementById('referralCode').textContent = currentUser.referralCode || 'No disponible';
            document.getElementById('referralsCount').textContent = currentUser.referrals?.length || 0;
            document.getElementById('referralEarnings').textContent = ((currentUser.referrals?.length || 0) * 10);
            
            // Actualizar badge
            const badge = document.getElementById('userBadge');
            if (currentUser.referrals?.length > 0) {
                badge.textContent = currentUser.referrals.length;
                badge.style.display = 'flex';
            } else {
                badge.style.display = 'none';
            }
        }
        
        // Actualizar avatar
        function updateUserAvatar() {
            if (!currentUser) return;
            
            const avatar = document.getElementById('userAvatar');
            const initial = document.getElementById('avatarInitial');
            
            if (currentUser.type === 'guest') {
                avatar.style.background = 'linear-gradient(135deg, var(--warning), #d97706)';
            } else {
                avatar.style.background = 'linear-gradient(135deg, var(--primary), #2563eb)';
            }
            
            initial.textContent = currentUser.username.charAt(0).toUpperCase();
        }
        
        // Mostrar/ocultar men√∫ de usuario
        function toggleUserMenu() {
            const menu = document.getElementById('userMenu');
            menu.classList.toggle('active');
        }
        
        // Mostrar secci√≥n de cuenta
        function showAccountSection() {
            // Cambiar a pesta√±a de cuenta
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector('[data-tab="tab-account"]').classList.add('active');
            
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById('tab-account').classList.add('active');
            
            // Ocultar men√∫
            document.getElementById('userMenu').classList.remove('active');
        }
        
        // Mostrar secci√≥n de backup
        function showBackupSection() {
            showAccountSection();
            showBackupInput();
            document.getElementById('userMenu').classList.remove('active');
        }
        
        // Mostrar secci√≥n de referidos
        function showReferralSection() {
            showAccountSection();
            document.getElementById('userMenu').classList.remove('active');
        }
        
        // ================= FUNCIONES DE UTILIDAD =================
        
        // Generar ID de usuario
        function generateUserId() {
            return 'USR-' + Date.now().toString(36) + Math.random().toString(36).substring(2, 5).toUpperCase();
        }
        
        // Generar c√≥digo de referido
        function generateReferralCode() {
            return 'REF-' + Math.random().toString(36).substring(2, 8).toUpperCase();
        }
        
        // Hash de contrase√±a (simple - en producci√≥n usar bcrypt)
        function hashPassword(password) {
            // Simple hash para demostraci√≥n
            let hash = 0;
            for (let i = 0; i < password.length; i++) {
                hash = ((hash << 5) - hash) + password.charCodeAt(i);
                hash |= 0;
            }
            return hash.toString(36);
        }
        
        // Validar email
        function validateEmail(email) {
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return re.test(email);
        }
        
        // Generar checksum para verificar integridad
        function generateChecksum(data) {
            const str = JSON.stringify(data);
            let hash = 0;
            for (let i = 0; i < str.length; i++) {
                hash = ((hash << 5) - hash) + str.charCodeAt(i);
                hash |= 0;
            }
            return hash.toString(36);
        }
        
        // Mostrar/ocultar contrase√±a
        function togglePassword(inputId) {
            const input = document.getElementById(inputId);
            const toggle = input.nextElementSibling;
            
            if (input.type === 'password') {
                input.type = 'text';
                toggle.innerHTML = '<i class="fas fa-eye-slash"></i>';
            } else {
                input.type = 'password';
                toggle.innerHTML = '<i class="fas fa-eye"></i>';
            }
        }
        
        // Copiar al portapapeles
        function copyToClipboard(elementId) {
            const element = document.getElementById(elementId);
            const text = element.textContent || element.innerText;
            
            navigator.clipboard.writeText(text).then(() => {
                showNotification('Copiado al portapapeles', 'success');
            }).catch(err => {
                console.error('Error al copiar: ', err);
                showNotification('Error al copiar', 'error');
            });
        }
        
        // Mostrar notificaci√≥n
        function showNotification(message, type = "info") {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }
        
        // ================= INICIALIZACI√ìN =================
        
        // Inicializar cuando cargue la p√°gina
        window.addEventListener('DOMContentLoaded', () => {
            // Inicializar sistema de usuarios
            initUserSystem();
            
            // Configurar event listeners de tabs
            document.querySelectorAll('.tab-button').forEach(button => {
                button.addEventListener('click', () => {
                    const tabId = button.getAttribute('data-tab');
                    
                    document.querySelectorAll('.tab-button').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    button.classList.add('active');
                    
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    document.getElementById(tabId).classList.add('active');
                });
            });
            
            // Configurar event listeners de login tabs
            document.querySelectorAll('.login-tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    const formId = tab.getAttribute('data-form');
                    showForm(formId);
                });
            });
            
            // Cerrar men√∫ de usuario al hacer click fuera
            document.addEventListener('click', (e) => {
                const menu = document.getElementById('userMenu');
                const avatar = document.getElementById('userAvatar');
                
                if (menu.classList.contains('active') && 
                    !menu.contains(e.target) && 
                    !avatar.contains(e.target)) {
                    menu.classList.remove('active');
                }
            });
        });
        
        // Guardar datos autom√°ticamente cada 30 segundos
        setInterval(() => {
            if (currentUser) {
                saveUserData();
            }
        }, 30000); // 30 segundos
    </script>
</body>
</html>